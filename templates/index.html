<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVNä»£ç ç»Ÿè®¡å·¥å…·</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="shortcut icon" type="image/svg+xml" href="/static/favicon.svg">
    <!-- Chart.jsåº“å¿…é¡»åœ¨æ‰€æœ‰JavaScriptä»£ç ä¹‹å‰åŠ è½½ -->
    <!-- æœ¬åœ°Chart.jsæ–‡ä»¶ï¼Œé¿å…CDNä¾èµ– -->
    <script src="/static/js/chart.min.js"></script>
    <!-- å¦‚æœæœ¬åœ°Chart.jsæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„é™çº§æ–¹æ¡ˆ -->
    <script>
        if (typeof Chart === 'undefined') {
            // ç®€å•çš„Chart.jsé™çº§å®ç°ï¼Œä»…æä¾›åŸºæœ¬åŠŸèƒ½
            window.Chart = function () {
                console.warn('Chart.js not loaded, using fallback implementation');
                return {
                    update: function () { },
                    destroy: function () { }
                };
            };
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            padding: 30px 0;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 30px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            position: relative;
        }

        .card-toggle-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            transform: translateY(-50%);
            font-size: 1.2em;
            color: #667eea;
            cursor: pointer;
        }

        .card-content {
            max-height: 10000px;
            overflow: hidden;
            transition: max-height 0.3s ease-in;
        }

        .card-content.collapsed {
            max-height: 0;
            transition: max-height 0.2s ease-out;
        }


        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(220, 53, 69, 0.4);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .date-shortcuts {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .date-shortcut-btn {
            padding: 8px 16px;
            border: 1px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .date-shortcut-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .progress-container {
            margin-top: 20px;
            display: none;
        }

        .progress-bar {
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
        }

        .progress-message {
            text-align: center;
            margin-top: 10px;
            color: #666;
        }

        .execution-details {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .execution-details-content {
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .filters select,
        .filters input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            min-width: 150px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }

        .chart-tabs {
            margin-bottom: 15px;
        }

        .chart-tab {
            display: inline-block;
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .chart-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .stats-table th,
        .stats-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .stats-table th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }

        .stats-table tr:hover {
            background: #f9f9f9;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .error-message {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #667eea;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .config-container {
            margin-top: 20px;
        }

        .config-item {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .config-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .config-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .config-item-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-item-title {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .config-toggle-icon {
            display: flex;
            font-size: 1.2em;
            color: #667eea;
            cursor: pointer;
            flex-shrink: 0;
        }

        .config-item-actions {
            display: flex;
            gap: 10px;
        }

        .config-item-actions button {
            padding: 5px 10px;
            font-size: 0.9em;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .config-item-actions .btn-use {
            background: #667eea;
            color: white;
        }

        .config-item-actions .btn-use:hover {
            background: #5568d3;
        }

        .config-item-actions .btn-delete {
            background: #dc3545;
            color: white;
        }

        .config-item-actions .btn-delete:hover {
            background: #c82333;
        }

        .config-item-details {
            font-size: 0.9em;
            color: #666;
            line-height: 1.5;
        }

        .config-item-details div {
            margin-bottom: 5px;
        }

        .config-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .config-checkbox input {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        .config-checkbox label {
            font-weight: 500;
            color: #333;
        }

        .config-item-content {
            max-height: 10000px;
            overflow: hidden;
            transition: max-height 0.3s ease-in;
        }

        .config-item-content.collapsed {
            max-height: 0;
            transition: max-height 0.3s ease-out;
        }


        /* Message Popup Styles */
        .message-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            z-index: 1000;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .message-popup.show {
            transform: translateX(0);
        }

        .message-popup.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .message-popup.error {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }

        .message-popup.info {
            background: linear-gradient(135deg, #17a2b8 0%, #3498db 100%);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š SVNä»£ç ç»Ÿè®¡å·¥å…·</h1>
            <p>å¯è§†åŒ–åˆ†æSVNæäº¤è®°å½•ï¼Œæ”¯æŒå¤šåˆ†æ”¯ç»Ÿè®¡å’Œä»£ç è¡Œæ•°è¿½è¸ª</p>
        </div>

        <!-- é…ç½®ç®¡ç†åŒºåŸŸ -->
        <div class="card">
            <div class="card-head">
                <h2 class="card-title"> ğŸ“ é…ç½®ç®¡ç†
                    <span class="card-toggle-icon">â–¼</span>
                </h2>
            </div>

            <div class="card-content collapsed">
                <div class="form-grid">
                    <div id="config-list" style="max-height: 300px; overflow-y: auto;">
                        <!-- åŠ¨æ€ç”Ÿæˆé…ç½®åˆ—è¡¨ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- é…ç½®åŒºåŸŸ -->
        <div class="card">
            <div class="card-head">
                <h2 class="card-title"> âš™ï¸ SVNé…ç½®
                    <span class="card-toggle-icon">â–¼</span>
                </h2>
            </div>

            <div class="card-content">
                <div class="form-grid">

                    <div class="form-group">
                        <label for="name">é…ç½®åç§°</label>
                        <input type="text" id="name" placeholder="ä¾‹å¦‚: ä¸»åˆ†æ”¯">
                    </div>
                    <div class="form-group">
                        <label for="branch-url">SVNåˆ†æ”¯URL *</label>
                        <input type="text" id="branch-url" placeholder="ä¾‹å¦‚: http://svn.example.com/repo/branches/dev">
                    </div>

                    <div class="form-group">
                        <label for="username">ç”¨æˆ·å *</label>
                        <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>

                    <div class="form-group">
                        <label for="password">å¯†ç  *</label>
                        <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>

                    <div class="form-group">
                        <label for="revision-range">ç‰ˆæœ¬èŒƒå›´ (å¯é€‰)</label>
                        <input type="text" id="revision-range" placeholder="ä¾‹å¦‚: 100:200 æˆ– HEAD">
                    </div>
                    <div class="form-group">
                        <label for="full-analysis" style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="full-analysis" style="width: 18px; height: 18px;">
                            <span>å…¨é‡åˆ†æï¼ˆä¸é™åˆ¶ç‰ˆæœ¬èŒƒå›´ï¼‰</span>
                        </label>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveConfig()">
                        ğŸ’¾ ä¿å­˜
                    </button>
                    <button class="btn btn-primary" id="reset-btn" onclick="resetAnalysis()">
                        ğŸ”„ é‡ç½®
                    </button>
                    <button class="btn btn-primary" id="start-btn" onclick="startAnalysis()">
                        ğŸš€ å¼€å§‹åˆ†æ
                    </button>
                    <button class="btn btn-danger" onclick="clearCache()">
                        ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜
                    </button>
                </div>

                <div class="progress-container" id="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%">0%</div>
                    </div>
                    <div class="progress-message" id="progress-message">å‡†å¤‡ä¸­...</div>
                </div>

                <!-- ä»»åŠ¡æ‰§è¡Œæ˜ç»† -->
                <div class="execution-details" id="execution-details" style="display: none; ">
                    <h4 style="margin-top: 0; margin-bottom: 10px; color: #333;">ä»»åŠ¡æ‰§è¡Œæ˜ç»†</h4>
                    <div id="execution-details-content" class="execution-details-content">
                        <!-- åŠ¨æ€å¡«å……æ‰§è¡Œæ˜ç»† -->
                    </div>
                </div>

                <div class="error-message" id="error-message"></div>
            </div>
        </div>

        <!-- ç­›é€‰åŒºåŸŸ -->
        <div class="card">
            <div class="card-head">
                <h2 class="card-title"> âš™ï¸ ç­›é€‰ </h2>
            </div>

            <div class="card-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="start-date">å¼€å§‹æ—¥æœŸ (å¯é€‰)</label>
                        <input type="date" id="start-date"">
                    </div>

                    <div class=" form-group">
                        <label for="end-date">ç»“æŸæ—¥æœŸ (å¯é€‰)</label>
                        <input type="date" id="end-date"">
                    </div>
                </div>

                <div class=" date-shortcuts">
                        <button class="date-shortcut-btn" onclick="setDateRange('today')">ä»Šæ—¥</button>
                        <button class="date-shortcut-btn" onclick="setDateRange('week')">æœ¬å‘¨</button>
                        <button class="date-shortcut-btn" onclick="setDateRange('month')">æœ¬æœˆ</button>
                        <button class="date-shortcut-btn" onclick="setDateRange('last30Days')">æœ€è¿‘30å¤©</button>
                        <button class="date-shortcut-btn" onclick="setDateRange('year')">æœ¬å¹´</button>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" id="start-btn" onclick="queryResults()">
                            ğŸ” æŸ¥è¯¢
                        </button>
                    </div>

                </div>
            </div>

            <!-- ç»“æœåŒºåŸŸ -->
            <div class="card" id="results-card" style="display: none;">
                <div class="card-head">
                    <h2 class="card-title">ğŸ“Š åˆ†æç»“æœ</h2>
                </div>

                <div class="card-content">
                    <div class="nav-tabs">
                        <button class="nav-tab active" onclick="showSection('overview')">ğŸ“ˆ æ¦‚è§ˆ</button>
                        <button class="nav-tab" onclick="showSection('monthly')">ğŸ“… æœˆåº¦ç»Ÿè®¡</button>
                        <button class="nav-tab" onclick="showSection('daily')">ğŸ“† æ¯æ—¥ç»Ÿè®¡</button>
                        <button class="nav-tab" onclick="showSection('authors')">ğŸ‘¥ ä½œè€…ç»Ÿè®¡</button>
                        <button class="nav-tab" onclick="showSection('branches')">ğŸŒ¿ åˆ†æ”¯ç»Ÿè®¡</button>
                    </div>

                    <!-- æ¦‚è§ˆ -->
                    <div id="overview" class="section active">
                        <h3 class="card-title">ğŸ“Š ç»Ÿè®¡æ¦‚è§ˆ</h3>

                        <div class="stats-summary" id="stats-summary">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <div class="chart-tabs">
                            <button class="chart-tab active" onclick="switchSummaryChart('files')">ä¿®æ”¹æ–‡ä»¶æ•°</button>
                            <button class="chart-tab" onclick="switchSummaryChart('lines')">ä»£ç è¡Œæ•°</button>
                        </div>

                        <div class="filters">
                            <label>ç­›é€‰:</label>
                            <select id="overview-author-filter" onchange="updateOverviewChart()">
                                <option value="all">æ‰€æœ‰ä½œè€…</option>
                            </select>
                            <select id="overview-chart-type" onchange="updateOverviewChart()">
                                <option value="line">æŠ˜çº¿å›¾</option>
                                <option value="bar">æŸ±çŠ¶å›¾</option>
                            </select>
                        </div>

                        <div class="chart-container">
                            <canvas id="overviewChart"></canvas>
                        </div>
                    </div>

                    <!-- æœˆåº¦ç»Ÿè®¡ -->
                    <div id="monthly" class="section">
                        <h3 class="card-title">ğŸ“… æœˆåº¦æäº¤ç»Ÿè®¡</h3>

                        <div class="chart-tabs">
                            <button class="chart-tab active" onclick="switchMonthlyChart('files')">ä¿®æ”¹æ–‡ä»¶æ•°</button>
                            <button class="chart-tab" onclick="switchMonthlyChart('lines')">ä»£ç è¡Œæ•°</button>
                        </div>

                        <div class="filters">
                            <label>ç­›é€‰:</label>
                            <select id="monthly-author-filter" onchange="updateMonthlyChart()">
                                <option value="all">æ‰€æœ‰ä½œè€…</option>
                            </select>
                            <select id="monthly-chart-type" onchange="updateMonthlyChart()">
                                <option value="line">æŠ˜çº¿å›¾</option>
                                <option value="bar">æŸ±çŠ¶å›¾</option>
                            </select>
                        </div>

                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>

                    <!-- æ¯æ—¥ç»Ÿè®¡ -->
                    <div id="daily" class="section">
                        <h3 class="card-title">ğŸ“† æ¯æ—¥æäº¤ç»Ÿè®¡</h3>

                        <div class="chart-tabs">
                            <button class="chart-tab active" onclick="switchDailyChart('files')">ä¿®æ”¹æ–‡ä»¶æ•°</button>
                            <button class="chart-tab" onclick="switchDailyChart('lines')">ä»£ç è¡Œæ•°</button>
                        </div>

                        <div class="filters">
                            <label>ç­›é€‰:</label>
                            <select id="daily-author-filter" onchange="updateDailyChart()">
                                <option value="all">æ‰€æœ‰ä½œè€…</option>
                            </select>
                            <select id="daily-chart-type" onchange="updateDailyChart()">
                                <option value="line">æŠ˜çº¿å›¾</option>
                                <option value="bar">æŸ±çŠ¶å›¾</option>
                            </select>
                        </div>

                        <div class="chart-container">
                            <canvas id="dailyChart"></canvas>
                        </div>
                    </div>

                    <!-- ä½œè€…ç»Ÿè®¡ -->
                    <div id="authors" class="section">
                        <h3 class="card-title">ğŸ‘¥ ä½œè€…ç»Ÿè®¡æ±‡æ€»</h3>

                        <table class="stats-table" id="authors-table">
                            <thead>
                                <tr>
                                    <th>ä½œè€…</th>
                                    <th>æäº¤æ¬¡æ•°</th>
                                    <th>ä¿®æ”¹æ–‡ä»¶æ•°</th>
                                    <th>æ–°å¢ä»£ç è¡Œ</th>
                                    <th>åˆ é™¤ä»£ç è¡Œ</th>
                                    <th>å‡€å¢ä»£ç è¡Œ</th>
                                    <th>å‚ä¸åˆ†æ”¯</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <!-- åˆ†æ”¯ç»Ÿè®¡ -->
                    <div id="branches" class="section">
                        <h3 class="card-title">ğŸŒ¿ åˆ†æ”¯ç»Ÿè®¡æ±‡æ€»</h3>

                        <table class="stats-table" id="branches-table">
                            <thead>
                                <tr>
                                    <th>åˆ†æ”¯</th>
                                    <th>æäº¤æ¬¡æ•°</th>
                                    <th>ä¿®æ”¹æ–‡ä»¶æ•°</th>
                                    <th>å‚ä¸ä½œè€…</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let analysisData = null;
            let overviewChart = null;
            let monthlyChart = null;
            let dailyChart = null;
            let currentOverviewType = 'files';
            let currentMonthlyType = 'files';
            let currentDailyType = 'files';
            let savedConfigs = [];

            // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
            window.addEventListener('load', function () {
                addSectionToggleFunctionality();
                loadSavedConfigs();
                queryResults();
            });

            // æ·»åŠ sectionæ”¶èµ·/å±•å¼€åŠŸèƒ½
            function addSectionToggleFunctionality() {
                // è·å–æ‰€æœ‰section
                const sections = document.querySelectorAll('.card');

                sections.forEach(section => {
                    // è·å–headerå’Œcontentå…ƒç´ 
                    const header = section.querySelector('.card-head');
                    const content = section.querySelector('.card-content');
                    const icon = header.querySelector('.card-toggle-icon');

                    // æ›´æ–°å›¾æ ‡
                    if (icon) {
                        if (content.classList.contains('collapsed')) {
                            icon.textContent = 'â–¼';
                        } else {
                            icon.textContent = 'â–²';
                        }
                    }

                    if (header && content && icon) {
                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶åˆ°header
                        icon.addEventListener('click', () => {
                            // åˆ‡æ¢contentçš„collapsedç±»
                            // æ›´æ–°å›¾æ ‡
                            if (content.classList.contains('collapsed')) {
                                content.classList.remove('collapsed');
                                icon.textContent = 'â–²';
                            } else {
                                content.classList.add('collapsed');
                                icon.textContent = 'â–¼';
                            }
                        });
                    }
                });
            }

            // ä¿å­˜é…ç½®åˆ°æœ¬åœ°å­˜å‚¨
            function saveConfig() {
                const configName = document.getElementById('name').value.trim();
                const branchUrl = document.getElementById('branch-url').value.trim();
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();

                if (!configName) {
                    showError('è¯·è¾“å…¥é…ç½®åç§°');
                    return;
                }

                if (!branchUrl) {
                    showError('è¯·è¾“å…¥SVNåˆ†æ”¯URL');
                    return;
                }

                // æ£€æŸ¥åˆ†æ”¯URLæ˜¯å¦å·²ç»å­˜åœ¨
                const existingConfig = savedConfigs.find(config => config.branchUrl === branchUrl);
                if (existingConfig) {
                    showError('è¯¥åˆ†æ”¯URLå·²å­˜åœ¨ï¼Œä¸æ”¯æŒé‡å¤ä¿å­˜');
                    return;
                }

                const config = {
                    id: Date.now(),
                    name: configName,
                    branchUrl: branchUrl,
                    username: username,
                    password: password,
                    createdAt: new Date().toISOString()
                };

                savedConfigs.push(config);
                localStorage.setItem('svnConfigs', JSON.stringify(savedConfigs));

                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('name').value = '';
                document.getElementById('branch-url').value = '';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';

                showMessage('é…ç½®ä¿å­˜æˆåŠŸ', 'success');
                // åˆ·æ–°é…ç½®åˆ—è¡¨
                renderConfigList();
            }

            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½é…ç½®
            function loadSavedConfigs() {
                const configs = localStorage.getItem('svnConfigs');
                if (configs) {
                    savedConfigs = JSON.parse(configs);
                    renderConfigList();
                    addConfigToggleFunctionality();
                }
            }

            // æ¸²æŸ“é…ç½®åˆ—è¡¨
            function renderConfigList() {
                const configList = document.getElementById('config-list');

                if (savedConfigs.length === 0) {
                    configList.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">æš‚æ— ä¿å­˜çš„é…ç½®</p>';
                    return;
                }

                let html = '';
                savedConfigs.forEach(config => {
                    html += `
                    <div class="config-item">
                        <div class="config-item-header">
                            <div class="config-item-left">
                                <div class="config-toggle-icon">â–¼</div>
                                <div class="config-item-title">${config.name}</div>
                            </div>
                            <div class="config-item-actions">
                                <button class="btn-use" onclick="useConfig(${config.id})">ä½¿ç”¨</button>
                                <button class="btn-delete" onclick="deleteConfig(${config.id})">åˆ é™¤</button>
                            </div>
                        </div>
                        <div class="config-item-content collapsed">
                            <div class="config-item-details">
                                <div><strong>åˆ†æ”¯URL:</strong> ${config.branchUrl}</div>
                                <div><strong>ç”¨æˆ·å:</strong> ${config.username || 'æœªè®¾ç½®'}</div>
                                <div><strong>åˆ›å»ºæ—¶é—´:</strong> ${new Date(config.createdAt).toLocaleString()}</div>
                            </div>
                            <div class="config-checkbox">
                                <input type="checkbox" id="config-${config.id}" value="${config.id}" onchange="updateSelectedCount()">
                                <label for="config-${config.id}">é€‰æ‹©æ­¤é…ç½®è¿›è¡Œåˆ†æ</label>
                            </div>
                        </div>
                    </div>
                `;
                });

                configList.innerHTML = html;
            }

            // æ›´æ–°å·²é€‰é…ç½®æ•°é‡æç¤º
            function updateSelectedCount() {
                const checkboxes = document.querySelectorAll('.config-checkbox input[type="checkbox"]');
                const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;

                if (selectedCount > 0) {
                    showMessage(`å·²é€‰æ‹© ${selectedCount} ä¸ªé…ç½®`, 'info');
                    showError(`å·²é€‰æ‹© ${selectedCount} ä¸ªé…ç½®`);
                } else {
                    cleanError();
                }
            }

            // æ·»åŠ sectionæ”¶èµ·/å±•å¼€åŠŸèƒ½
            function addConfigToggleFunctionality() {
                // è·å–æ‰€æœ‰config-item
                const sections = document.querySelectorAll('.config-item');

                sections.forEach(section => {
                    // è·å–headerå’Œcontentå…ƒç´ 
                    const header = section.querySelector('.config-item-header');
                    const content = section.querySelector('.config-item-content');
                    const icon = header.querySelector('.config-toggle-icon');
                    // æ›´æ–°å›¾æ ‡
                    if (icon) {
                        if (content.classList.contains('collapsed')) {
                            icon.textContent = 'â–¼';
                        } else {
                            icon.textContent = 'â–²';
                        }
                    }
                    if (header && content && icon) {
                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶åˆ°header
                        icon.addEventListener('click', () => {
                            // åˆ‡æ¢contentçš„collapsedç±»
                            // æ›´æ–°å›¾æ ‡
                            if (content.classList.contains('collapsed')) {
                                content.classList.remove('collapsed');
                                icon.textContent = 'â–²';
                            } else {
                                content.classList.add('collapsed');
                                icon.textContent = 'â–¼';
                            }
                        });
                    }
                });
            }


            // ä½¿ç”¨é…ç½®
            function useConfig(configId) {
                const config = savedConfigs.find(c => c.id === configId);
                if (config) {
                    document.getElementById('name').value = config.name;
                    document.getElementById('branch-url').value = config.branchUrl;
                    document.getElementById('username').value = config.username || '';
                    document.getElementById('password').value = config.password || '';
                }
            }

            // åˆ é™¤é…ç½®
            function deleteConfig(configId) {
                if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤é…ç½®å—ï¼Ÿ')) {
                    savedConfigs = savedConfigs.filter(c => c.id !== configId);
                    localStorage.setItem('svnConfigs', JSON.stringify(savedConfigs));
                    renderConfigList();
                }
            }

            // è·å–é€‰ä¸­çš„é…ç½®
            function getSelectedConfigs() {
                const selectedConfigs = [];
                savedConfigs.forEach(config => {
                    const checkbox = document.getElementById(`config-${config.id}`);
                    if (checkbox && checkbox.checked) {
                        selectedConfigs.push(config);
                    }
                });
                return selectedConfigs;
            }



            // ä¸ºDateå¯¹è±¡æ·»åŠ addDaysæ–¹æ³•
            Date.prototype.addDays = function (days) {
                const date = new Date(this.valueOf());
                date.setDate(date.getDate() + days);
                return date;
            };

            // è®¾ç½®æ—¥æœŸèŒƒå›´å¿«æ·æŒ‰é’®
            function setDateRange(rangeType) {
                const today = new Date();
                let startDate, endDate;

                switch (rangeType) {
                    case 'today':
                        startDate = today;
                        endDate = today;
                        break;
                    case 'week':
                        const dayOfWeek = today.getDay();
                        const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
                        startDate = new Date(today.setDate(diff));
                        endDate = new Date();
                        break;
                    case 'month':
                        startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                        endDate = new Date();
                        break;
                    case 'last30Days':
                        startDate = new Date();
                        startDate.setDate(today.getDate() - 30);
                        endDate = new Date();
                        break;
                    case 'year':
                        startDate = new Date(today.getFullYear(), 0, 1);
                        endDate = new Date();
                        break;
                }

                // é¿å… toISOString å¸¦æ¥çš„æ—¶åŒºåç§»ï¼Œæ‰‹åŠ¨æ‹¼æ¥æœ¬åœ°æ—¥æœŸå­—ç¬¦ä¸²
                const pad = n => n.toString().padStart(2, '0');
                const fmt = d => `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
                document.getElementById('start-date').value = fmt(startDate);
                document.getElementById('end-date').value = fmt(endDate);
            }

            // å¼€å§‹åˆ†æ
            async function startAnalysis() {
                const selectedConfigs = getSelectedConfigs();
                const branchUrl = document.getElementById('branch-url').value.trim();
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                const revisionRange = document.getElementById('revision-range').value.trim();
                const startDate = document.getElementById('start-date').value.trim();
                const endDate = document.getElementById('end-date').value.trim();
                const fullAnalysis = document.getElementById('full-analysis').checked;

                // æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†é…ç½®æˆ–æ‰‹åŠ¨è¾“å…¥äº†åˆ†æ”¯URL
                if (selectedConfigs.length === 0 && !branchUrl) {
                    showError('è¯·é€‰æ‹©é…ç½®æˆ–è¾“å…¥SVNåˆ†æ”¯URL');
                    return;
                }

                // ç¦ç”¨æŒ‰é’®
                document.getElementById('start-btn').disabled = true;
                document.getElementById('start-btn').textContent = 'åˆ†æä¸­...';

                // æ˜¾ç¤ºè¿›åº¦
                document.getElementById('progress-container').style.display = 'block';
                document.getElementById('error-message').style.display = 'none';
                document.getElementById('results-card').style.display = 'none';

                try {
                    let requestBody = {
                        start_date: startDate || null,
                        end_date: endDate || null,
                        full_analysis: fullAnalysis
                    };

                    // å¦‚æœå‹¾é€‰äº†å…¨é‡åˆ†æï¼Œä¸é™åˆ¶ç‰ˆæœ¬èŒƒå›´
                    if (fullAnalysis) {
                        requestBody.revision_range = null;
                    } else {
                        // å¦‚æœæ²¡æœ‰å‹¾é€‰å…¨é‡åˆ†æï¼ŒæœåŠ¡ç«¯é»˜è®¤ä»ç¼“å­˜è·å–æœ€æ–°ç‰ˆæœ¬å·
                        requestBody.revision_range = revisionRange;
                    }

                    // å¦‚æœé€‰æ‹©äº†é…ç½®ï¼Œä½¿ç”¨é…ç½®ä¿¡æ¯
                    if (selectedConfigs.length > 0) {
                        requestBody.branches = selectedConfigs.map(config => ({
                            branch_url: config.branchUrl,
                            username: config.username || null,
                            password: config.password || null
                        }));
                    } else {
                        // ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥çš„é…ç½®
                        requestBody.branch_url = branchUrl;
                        requestBody.username = username || null;
                        requestBody.password = password || null;
                    }

                    const response = await fetch('/api/start-analysis', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody)
                    });

                    const result = await response.json();

                    if (!result.success) {
                        showError(result.message);
                        resetButton();
                        return;
                    }

                    // å¼€å§‹è½®è¯¢çŠ¶æ€
                    pollStatus();

                } catch (error) {
                    showError('è¯·æ±‚å¤±è´¥: ' + error.message);
                    resetButton();
                }
            }

            // é‡ç½®åˆ†ææŒ‰é’®
            function resetAnalysis() {

                // æ¸…ç©ºè¾“å…¥å­—æ®µ
                document.getElementById('name').value = '';
                document.getElementById('branch-url').value = '';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('revision-range').value = '';
                document.getElementById('full-analysis').checked = false;

                // å–æ¶ˆé€‰ä¸­çš„é…ç½®
                const checkboxes = document.querySelectorAll('.config-checkbox input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });

                // æ›´æ–°å·²é€‰é…ç½®æ•°é‡
                updateSelectedCount();
            }

            // æ¸…é™¤ç¼“å­˜
            async function clearCache() {
                // äºŒæ¬¡ç¡®è®¤
                if (!confirm('æ˜¯å¦ç¡®è®¤æ¸…é™¤ç¼“å­˜ï¼Ÿ\næ¸…é™¤åä¼šé‡æ–°å¢é‡ç¼“å­˜æ—¥å¿—åˆ†æ')) {
                    return;
                }

                try {
                    const response = await fetch('/api/cache/clear', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert('ç¼“å­˜å·²æ¸…é™¤æˆåŠŸï¼');
                    } else {
                        alert('æ¸…é™¤ç¼“å­˜å¤±è´¥ï¼š' + result.message);
                    }
                } catch (error) {
                    alert('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
                }
            }

            // æ›´æ–°æ‰§è¡Œæ˜ç»†
            function updateExecutionDetails(details) {
                const detailsContainer = document.getElementById('execution-details-content');
                let html = '';

                details.forEach(item => {
                    // æ ¹æ®æ—¥å¿—çº§åˆ«è®¾ç½®ä¸åŒçš„é¢œè‰²
                    let color = '#666';
                    if (item.level === 'success') color = '#28a745';
                    else if (item.level === 'error') color = '#dc3545';
                    else if (item.level === 'info') color = '#17a2b8';
                    else if (item.level === 'debug') color = '#6c757d';

                    html += `<div style="color: ${color};">[${item.timestamp}] ${item.message}</div>`;
                });

                detailsContainer.innerHTML = html;

                // æ»šåŠ¨åˆ°åº•éƒ¨
                detailsContainer.scrollTop = detailsContainer.scrollHeight;
            }

            // è½®è¯¢çŠ¶æ€
            async function pollStatus() {
                try {
                    const response = await fetch('/api/status');
                    const status = await response.json();

                    // æ›´æ–°è¿›åº¦
                    document.getElementById('progress-fill').style.width = status.progress + '%';
                    document.getElementById('progress-fill').textContent = status.progress + '%';
                    document.getElementById('progress-message').textContent = status.message;

                    // æ›´æ–°æ‰§è¡Œæ˜ç»†
                    if (status.execution_details) {
                        document.getElementById('execution-details').style.display = 'block';
                        updateExecutionDetails(status.execution_details);
                    }

                    if (status.error) {
                        showError(status.error);
                        resetButton();
                        return;
                    }

                    if (status.completed) {
                        // è·å–ç»“æœ
                        queryResults();
                        resetButton();
                    } else if (status.running) {
                        // ç»§ç»­è½®è¯¢
                        setTimeout(pollStatus, 1000);
                    }

                } catch (error) {
                    console.error('çŠ¶æ€æŸ¥è¯¢å¤±è´¥:', error);
                    setTimeout(pollStatus, 1000);
                }
            }

            // åŠ è½½ç»“æœ
            async function queryResults() {
                try {
                    let today = new Date();
                    let startDate = document.getElementById('start-date').value.trim();
                    let endDate = document.getElementById('end-date').value.trim();

                    // è®¾ç½®é»˜è®¤æ—¥æœŸèŒƒå›´
                    if (!startDate) {
                        document.getElementById('start-date').value = today.addDays(-30).toISOString().split('T')[0];
                        startDate = document.getElementById('start-date').value;
                    }
                    if (!endDate) {
                        document.getElementById('end-date').value = today.toISOString().split('T')[0];
                        endDate = document.getElementById('end-date').value;
                    }

                    // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
                    showLoading();

                    const response = await fetch(`/api/results`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            startDate: startDate,
                            endDate: endDate
                        })
                    });
                    analysisData = await response.json();

                    // éšè—åŠ è½½åŠ¨ç”»
                    hideLoading();

                    loadResult(analysisData);

                } catch (error) {
                    hideLoading();
                    // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
                    clearResults();
                    showError('åŠ è½½ç»“æœå¤±è´¥: ' + error.message);
                }
            }

            // åŠ è½½ç»“æœ
            function loadResult(analysisData) {
                // å¦‚æœæœ‰æ•°æ®ï¼Œç›´æ¥æ˜¾ç¤ºç»“æœ
                if (analysisData && Array.isArray(analysisData.commits) && analysisData.commits.length > 0) {
                    // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                    document.getElementById('results-card').style.display = 'block';

                    // ç”Ÿæˆç»Ÿè®¡æ¦‚è§ˆ
                    generateStatsSummary();

                    // åˆå§‹åŒ–ç­›é€‰é€‰é¡¹
                    initFilters();

                    // åˆå§‹åŒ–å›¾è¡¨
                    initCharts();

                    // ç”Ÿæˆè¡¨æ ¼
                    generateAuthorTable();
                    generateBranchTable();
                    showMessage('ç»“æœåŠ è½½æˆåŠŸ', 'success');
                } else {
                    // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
                    clearResults();
                    // æ˜¾ç¤ºæš‚æ— æ•°æ®æç¤º
                    showMessage('æš‚æ— æ•°æ®', 'info');
                }
            }

            // æ¸…ç©ºåˆ†æç»“æœ
            function clearResults() {

                // æ¸…ç©ºç»Ÿè®¡æ¦‚è§ˆ
                const statsSummary = document.getElementById('stats-summary');
                if (statsSummary) {
                    statsSummary.innerHTML = '';
                }

                // æ¸…ç©ºä½œè€…è¡¨æ ¼
                const authorTableBody = document.querySelector('#author-table tbody');
                if (authorTableBody) {
                    authorTableBody.innerHTML = '';
                }

                // æ¸…ç©ºåˆ†æ”¯è¡¨æ ¼
                const branchTableBody = document.querySelector('#branch-table tbody');
                if (branchTableBody) {
                    branchTableBody.innerHTML = '';
                }

                // æ¸…ç©ºå›¾è¡¨
                if (overviewChart) {
                    overviewChart.destroy();
                    overviewChart = null;
                }
                if (monthlyChart) {
                    monthlyChart.destroy();
                    monthlyChart = null;
                }
                if (dailyChart) {
                    dailyChart.destroy();
                    dailyChart = null;
                }

                // æ¸…ç©ºç­›é€‰é€‰é¡¹
                const overviewAuthorFilter = document.getElementById('overview-author-filter');
                if (overviewAuthorFilter) {
                    overviewAuthorFilter.innerHTML = '<option value="all">æ‰€æœ‰ä½œè€…</option>';
                }

                const monthlyAuthorFilter = document.getElementById('monthly-author-filter');
                if (monthlyAuthorFilter) {
                    monthlyAuthorFilter.innerHTML = '<option value="all">æ‰€æœ‰ä½œè€…</option>';
                }

                const dailyAuthorFilter = document.getElementById('daily-author-filter');
                if (dailyAuthorFilter) {
                    dailyAuthorFilter.innerHTML = '<option value="all">æ‰€æœ‰ä½œè€…</option>';
                }

                // éšè—ç»“æœåŒºåŸŸ
                // document.getElementById('results-card').style.display = 'none';
            }

            // ç”Ÿæˆç»Ÿè®¡æ¦‚è§ˆ
            function generateStatsSummary() {
                const netLines = analysisData.total_lines_added - analysisData.total_lines_deleted;
                const summaryHtml = `
                <div class="stat-card">
                    <div class="number">${analysisData.total_commits}</div>
                    <div class="label">æäº¤æ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="number">${analysisData.total_files}</div>
                    <div class="label">ä¿®æ”¹æ–‡ä»¶æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="number">${analysisData.total_lines_added}</div>
                    <div class="label">æ–°å¢ä»£ç è¡Œ</div>
                </div>
                <div class="stat-card">
                    <div class="number">${analysisData.total_lines_deleted}</div>
                    <div class="label">åˆ é™¤ä»£ç è¡Œ</div>
                </div>
                <div class="stat-card">
                    <div class="number">${netLines}</div>
                    <div class="label">å‡€å¢ä»£ç è¡Œ</div>
                </div>
                <div class="stat-card">
                    <div class="number">${analysisData.chart_data.authors.length}</div>
                    <div class="label">å‚ä¸ä½œè€…</div>
                </div>
                <div class="stat-card">
                    <div class="number">${analysisData.chart_data.branches.length}</div>
                    <div class="label">åˆ†æ”¯æ•°é‡</div>
                </div>
            `;
                document.getElementById('stats-summary').innerHTML = summaryHtml;
            }




            // åˆå§‹åŒ–ç­›é€‰é€‰é¡¹
            function initFilters() {
                const authors = analysisData.chart_data.authors;
                const authorOptions = '<option value="all">æ‰€æœ‰ä½œè€…</option>' +
                    authors.map(a => `<option value="${a}">${a}</option>`).join('');

                ['overview', 'monthly', 'daily'].forEach(prefix => {
                    document.getElementById(`${prefix}-author-filter`).innerHTML = authorOptions;
                });
            }

            // åˆå§‹åŒ–å›¾è¡¨
            function initCharts() {
                const chartData = analysisData.chart_data;

                // é”€æ¯ç°æœ‰å›¾è¡¨å®ä¾‹
                if (overviewChart) {
                    overviewChart.destroy();
                }
                if (monthlyChart) {
                    monthlyChart.destroy();
                }
                if (dailyChart) {
                    dailyChart.destroy();
                }

                // æ¦‚è§ˆå›¾è¡¨
                const overviewCtx = document.getElementById('overviewChart').getContext('2d');
                overviewChart = new Chart(overviewCtx, {
                    type: 'line',
                    data: {
                        labels: chartData.months,
                        datasets: chartData.monthlyDataFiles
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'æœˆåº¦æäº¤è¶‹åŠ¿'
                            },
                            legend: {
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'ä¿®æ”¹æ–‡ä»¶æ•°'
                                }
                            }
                        }
                    }
                });

                // æœˆåº¦å›¾è¡¨
                const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
                monthlyChart = new Chart(monthlyCtx, {
                    type: 'line',
                    data: {
                        labels: chartData.months,
                        datasets: chartData.monthlyDataFiles
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'æœˆåº¦æäº¤ç»Ÿè®¡ - ä¿®æ”¹æ–‡ä»¶æ•°'
                            },
                            legend: {
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'ä¿®æ”¹æ–‡ä»¶æ•°'
                                }
                            }
                        }
                    }
                });

                // æ¯æ—¥å›¾è¡¨
                const dailyCtx = document.getElementById('dailyChart').getContext('2d');
                dailyChart = new Chart(dailyCtx, {
                    type: 'line',
                    data: {
                        labels: chartData.days,
                        datasets: chartData.dailyDataFiles
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'æ¯æ—¥æäº¤ç»Ÿè®¡ - ä¿®æ”¹æ–‡ä»¶æ•°'
                            },
                            legend: {
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'ä¿®æ”¹æ–‡ä»¶æ•°'
                                }
                            }
                        }
                    }
                });
            }

            // æ›´æ–°æ¦‚è§ˆå›¾è¡¨
            function updateOverviewChart() {
                const authorFilter = document.getElementById('overview-author-filter').value;
                const chartType = document.getElementById('overview-chart-type').value;

                let filteredData = currentOverviewType === 'files' ?
                    analysisData.chart_data.monthlyDataFiles : analysisData.chart_data.monthlyDataLines;
                if (authorFilter !== 'all') {
                    filteredData = filteredData.filter(d => d.label === authorFilter);
                }

                overviewChart.config.type = chartType;
                overviewChart.data.datasets = filteredData;
                overviewChart.options.scales.y.title.text = currentOverviewType === 'files' ? 'ä¿®æ”¹æ–‡ä»¶æ•°' : 'ä»£ç è¡Œæ•°';
                overviewChart.options.plugins.title.text = `æœˆåº¦æäº¤è¶‹åŠ¿ - ${currentOverviewType === 'files' ? 'ä¿®æ”¹æ–‡ä»¶æ•°' : 'ä»£ç è¡Œæ•°'}`;
                overviewChart.update();
            }

            // åˆ‡æ¢æ¦‚è§ˆå›¾è¡¨ç±»å‹
            function switchSummaryChart(type) {
                currentOverviewType = type;

                // æ›´æ–°æ ‡ç­¾æ ·å¼
                document.querySelectorAll('#overview .chart-tab').forEach(tab => tab.classList.remove('active'));
                event.target.classList.add('active');

                // æ›´æ–°å›¾è¡¨
                const chartType = document.getElementById('overview-chart-type').value;
                const authorFilter = document.getElementById('overview-author-filter').value;

                let filteredData = type === 'files' ?
                    analysisData.chart_data.monthlyDataFiles : analysisData.chart_data.monthlyDataLines;
                if (authorFilter !== 'all') {
                    filteredData = filteredData.filter(d => d.label === authorFilter);
                }

                overviewChart.config.type = chartType;
                overviewChart.data.datasets = filteredData;
                overviewChart.options.scales.y.title.text = type === 'files' ? 'ä¿®æ”¹æ–‡ä»¶æ•°' : 'ä»£ç è¡Œæ•°';
                overviewChart.options.plugins.title.text = `æœˆåº¦æäº¤è¶‹åŠ¿ - ${type === 'files' ? 'ä¿®æ”¹æ–‡ä»¶æ•°' : 'ä»£ç è¡Œæ•°'}`;
                overviewChart.update();
            }

            // åˆ‡æ¢æœˆåº¦å›¾è¡¨ç±»å‹
            function switchMonthlyChart(type) {
                currentMonthlyType = type;

                // æ›´æ–°æ ‡ç­¾æ ·å¼
                document.querySelectorAll('#monthly .chart-tab').forEach(tab => tab.classList.remove('active'));
                event.target.classList.add('active');

                // æ›´æ–°å›¾è¡¨
                const chartType = document.getElementById('monthly-chart-type').value;
                const authorFilter = document.getElementById('monthly-author-filter').value;

                let filteredData = type === 'files' ?
                    analysisData.chart_data.monthlyDataFiles : analysisData.chart_data.monthlyDataLines;
                if (authorFilter !== 'all') {
                    filteredData = filteredData.filter(d => d.label === authorFilter);
                }

                monthlyChart.config.type = chartType;
                monthlyChart.data.datasets = filteredData;
                monthlyChart.options.scales.y.title.text = type === 'files' ? 'ä¿®æ”¹æ–‡ä»¶æ•°' : 'ä»£ç è¡Œæ•°';
                monthlyChart.options.plugins.title.text = `æœˆåº¦æäº¤ç»Ÿè®¡ - ${type === 'files' ? 'ä¿®æ”¹æ–‡ä»¶æ•°' : 'ä»£ç è¡Œæ•°'}`;
                monthlyChart.update();
            }

            // æ›´æ–°æœˆåº¦å›¾è¡¨
            function updateMonthlyChart() {
                const authorFilter = document.getElementById('monthly-author-filter').value;
                const chartType = document.getElementById('monthly-chart-type').value;

                let filteredData = currentMonthlyType === 'files' ?
                    analysisData.chart_data.monthlyDataFiles : analysisData.chart_data.monthlyDataLines;
                if (authorFilter !== 'all') {
                    filteredData = filteredData.filter(d => d.label === authorFilter);
                }

                monthlyChart.config.type = chartType;
                monthlyChart.data.datasets = filteredData;
                monthlyChart.update();
            }

            // åˆ‡æ¢æ¯æ—¥å›¾è¡¨ç±»å‹
            function switchDailyChart(type) {
                currentDailyType = type;

                document.querySelectorAll('#daily .chart-tab').forEach(tab => tab.classList.remove('active'));
                event.target.classList.add('active');

                const chartType = document.getElementById('daily-chart-type').value;
                const authorFilter = document.getElementById('daily-author-filter').value;

                let filteredData = type === 'files' ?
                    analysisData.chart_data.dailyDataFiles : analysisData.chart_data.dailyDataLines;
                if (authorFilter !== 'all') {
                    filteredData = filteredData.filter(d => d.label === authorFilter);
                }

                dailyChart.config.type = chartType;
                dailyChart.data.datasets = filteredData;
                dailyChart.options.scales.y.title.text = type === 'files' ? 'ä¿®æ”¹æ–‡ä»¶æ•°' : 'ä»£ç è¡Œæ•°';
                dailyChart.options.plugins.title.text = `æ¯æ—¥æäº¤ç»Ÿè®¡ - ${type === 'files' ? 'ä¿®æ”¹æ–‡ä»¶æ•°' : 'ä»£ç è¡Œæ•°'}`;
                dailyChart.update();
            }

            // æ›´æ–°æ¯æ—¥å›¾è¡¨
            function updateDailyChart() {
                const authorFilter = document.getElementById('daily-author-filter').value;
                const chartType = document.getElementById('daily-chart-type').value;

                let filteredData = currentDailyType === 'files' ?
                    analysisData.chart_data.dailyDataFiles : analysisData.chart_data.dailyDataLines;
                if (authorFilter !== 'all') {
                    filteredData = filteredData.filter(d => d.label === authorFilter);
                }

                dailyChart.config.type = chartType;
                dailyChart.data.datasets = filteredData;
                dailyChart.update();
            }

            // ç”Ÿæˆä½œè€…è¡¨æ ¼
            function generateAuthorTable() {
                const tbody = document.querySelector('#authors-table tbody');
                const rows = [];

                for (const [author, stats] of Object.entries(analysisData.author_stats)) {
                    const netLines = stats.lines_added - stats.lines_deleted;
                    rows.push(`
                    <tr>
                        <td>${author}</td>
                        <td>${stats.commits}</td>
                        <td>${stats.files_changed}</td>
                        <td>${stats.lines_added}</td>
                        <td>${stats.lines_deleted}</td>
                        <td>${netLines}</td>
                        <td>${stats.branches.join(', ')}</td>
                    </tr>
                `);
                }

                tbody.innerHTML = rows.join('');
            }

            // ç”Ÿæˆåˆ†æ”¯è¡¨æ ¼
            function generateBranchTable() {
                const tbody = document.querySelector('#branches-table tbody');
                const rows = [];

                for (const [branch, stats] of Object.entries(analysisData.branch_stats)) {
                    rows.push(`
                    <tr>
                        <td>${branch}</td>
                        <td>${stats.commits}</td>
                        <td>${stats.files_changed}</td>
                        <td>${stats.authors.join(', ')}</td>
                    </tr>
                `);
                }

                tbody.innerHTML = rows.join('');
            }

            // æ˜¾ç¤ºåŒºåŸŸ
            function showSection(sectionId) {
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));

                document.getElementById(sectionId).classList.add('active');
                event.target.classList.add('active');
            }

            // é‡ç½®æŒ‰é’®
            function resetButton() {
                document.getElementById('start-btn').disabled = false;
                document.getElementById('start-btn').textContent = 'ğŸš€ å¼€å§‹åˆ†æ';
            }

            // æ˜¾ç¤ºé”™è¯¯
            function showError(message) {
                const errorDiv = document.getElementById('error-message');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }
            function cleanError() {
                const errorDiv = document.getElementById('error-message');
                errorDiv.textContent = '';
                errorDiv.style.display = 'none';
            }

            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            function showLoading() {
                const resultsCard = document.getElementById('results-card');
                if (resultsCard) {
                    resultsCard.style.display = 'none';
                }

                // åˆ›å»ºåŠ è½½é®ç½©å±‚
                const loadingOverlay = document.createElement('div');
                loadingOverlay.id = 'loading-overlay';
                loadingOverlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0.9);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 9999;
                `;

                // åˆ›å»ºåŠ è½½åŠ¨ç”»å®¹å™¨
                const loadingContainer = document.createElement('div');
                loadingContainer.style.cssText = `
                    text-align: center;
                `;

                // åˆ›å»ºæ—‹è½¬åŠ¨ç”»
                const spinner = document.createElement('div');
                spinner.style.cssText = `
                    width: 50px;
                    height: 50px;
                    border: 4px solid #667eea;
                    border-top-color: transparent;
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                    margin: 0 auto 20px;
                `;

                // åˆ›å»ºåŠ è½½æ–‡å­—
                const loadingText = document.createElement('div');
                loadingText.textContent = 'æ­£åœ¨åŠ è½½æ•°æ®...';
                loadingText.style.cssText = `
                    font-size: 16px;
                    color: #666;
                    margin-top: 10px;
                `;

                // ç»„è£…åŠ è½½åŠ¨ç”»
                loadingContainer.appendChild(spinner);
                loadingContainer.appendChild(loadingText);
                loadingOverlay.appendChild(loadingContainer);

                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(loadingOverlay);
            }

            // éšè—åŠ è½½åŠ¨ç”»
            function hideLoading() {
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.remove();
                }
            }


            // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯ï¼ˆå¼¹çª—å½¢å¼ï¼‰
            function showMessage(message, type) {
                // åˆ›å»ºå¼¹çª—å…ƒç´ 
                const popup = document.createElement('div');
                popup.className = `message-popup ${type}`;
                popup.textContent = message;

                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(popup);

                // æ˜¾ç¤ºå¼¹çª—
                setTimeout(() => {
                    popup.classList.add('show');
                }, 100);

                // 3ç§’åéšè—å¹¶ç§»é™¤å¼¹çª—
                setTimeout(() => {
                    popup.classList.remove('show');
                    setTimeout(() => {
                        if (popup.parentNode) {
                            popup.parentNode.removeChild(popup);
                        }
                    }, 300);
                }, 3000);

            }

        </script>
</body>

</html>